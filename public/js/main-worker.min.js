function generateRandomColor(){return"#"+Math.floor(16777215*Math.random()).toString(16).padStart(6,"0")}function generateRandomColors(){var e=[];for(const o of arguments){var a=[];for(let e=0;e<o;e++)a.push(generateRandomColor());e.push(a)}return e}async function buildGeoJSON(e,t,n){let s={type:"FeatureCollection",features:[]};return await Promise.all(e.map(async(e,a)=>{for(const o of await Promise.all(e.map(async a=>{try{return await(await fetch("/"+a,{cache:"force-cache"})).json()}catch(e){console.error(e),console.error("Error finding or parsing geojson file: "+a)}return{}})))for(const r of"FeatureCollection"===o.type?o.features:[o])r.properties={},r.properties.fill=t[a],r.properties.eventIndex=a,r.properties.source=n,s.features.push(r)})),s}self.addEventListener("message",async function(e){var a=e.data.timestamp||"0",o=e.data.dateOfTimestamp,r="true"===e.data.onlyNewData?"new":"all",r="/api/"+["disaster","report","news"][e.data.source]+"/"+r+"/"+a,a=await(await fetch(r)).json();for(const s of a)s.daysSinceEvent=Math.floor((o-new Date(s.date))/864e5);var t=[];for(const i of a)t.push(JSON.parse(i.geojson));var[r]=generateRandomColors(a.length),n=await buildGeoJSON(t,r,0);self.postMessage({source:e.data.source,serverData:a,geoJSON:n,colors:r})});