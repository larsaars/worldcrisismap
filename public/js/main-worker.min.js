function generateRandomColor(){return"#"+Math.floor(16777215*Math.random()).toString(16).padStart(6,"0")}function generateRandomColors(){var e=[];for(const t of arguments){var a=[];for(let e=0;e<t;e++)a.push(generateRandomColor());e.push(a)}return e}async function buildGeoJSON(e,r,s){let n={type:"FeatureCollection",features:[]};return await Promise.all(e.map(async(e,a)=>{for(const t of await Promise.all(e.map(async e=>{return(await fetch("/"+e,{cache:"force-cache"})).json()})))for(const o of"FeatureCollection"===t.type?t.features:[t])o.properties={},o.properties.fill=r[a],o.properties.eventIndex=a,o.properties.source=s,n.features.push(o)})),n}self.addEventListener("message",async function(e){var a=e.data.timestamp||"0",t=e.data.dateOfTimestamp,o="true"===e.data.onlyNewData?"new":"all",o="/api/"+["disaster","report","news"][e.data.source]+"/"+o+"/"+a,a=await(await fetch(o)).json();for(const n of a)n.daysSinceEvent=Math.floor((t-new Date(n.date))/864e5);var r=[];for(const c of a)r.push(JSON.parse(c.geojson));var[o]=generateRandomColors(a.length),s=await buildGeoJSON(r,o,0);self.postMessage({source:e.data.source,serverData:a,geoJSON:s,colors:o})});