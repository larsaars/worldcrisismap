let sidebarIsClosed=!0,selectedMarker=null,settingsOpened=!1,loading=!0,datePickerDivHiddenOnSidebar=!1;function pageIsMobileFormat(){return 1.4<=$(window).innerHeight()/$(window).innerWidth()}function setLoading(e){e!==loading&&(e?$("#earth").show():$("#earth").hide(),$("#settings").animate({width:"toggle",height:"toggle"}),loading=e)}function hexToRgb(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,r,a){return t+t+r+r+a+a});e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function useBlack(e){e=hexToRgb(e);return 150<(299*e.r+587*e.g+114*e.b)/1e3}function getGeoJSONFromEvent(e,t){var r={type:"FeatureCollection",features:[]};for(const a of e.features)a.properties.eventIndex===t&&r.features.push(a);return r}function getMarkerImagePath(e,t){return"/markers/"+(t?"black":"white")+"/"+e.toLowerCase().replace(/ /g,"_")+".png"}function toggleDatePickerDiv(e){e=e||pageIsMobileFormat();var t=$("#datePickerDiv");t.css("top",e?"auto":"0"),t.css("bottom",e?"0":"auto"),t.css("border-radius",e?"1rem 1rem 0 0":"0 0 1rem 1rem"),t.animate({height:"toggle"},{duration:200})}function openSideBar(e,t,r){var a=hexToRgb(t.color),i=$("#sidebar"),n=$("#sidebarContent"),o=pageIsMobileFormat(),s=o?"100%":"42%",n=(n.css("background",`rgba(${a.r}, ${a.g}, ${a.b}, 0.19)`),sidebarIsClosed?(i.css("width",s),i.animate({width:"toggle"},{complete:function(){$("#sidebarText").html(t.description),$("#sidebarText a").attr("target","_blank")}}),o&&($("#settings").animate({width:"toggle",height:"toggle"}),$("#datePickerDiv").is(":visible")&&(datePickerDivHiddenOnSidebar=!0,$("#datePickerDiv").animate({height:"toggle"})))):($("#sidebarText").html(t.description),$("#sidebarText a").attr("target","_blank")),getGeoJSONFromEvent(r,t.eventIndex));sidebarIsClosed||(e.removeLayer("marked-layer"),e.removeSource("marked")),e.addSource("marked",{type:"geojson",data:n}),e.addLayer({id:"marked-layer",type:"fill",source:"marked",layout:{},paint:{"fill-color":["get","fill"],"fill-opacity":.9}}),sidebarIsClosed=!1,selectedMarker=t}function closeSideBar(){var e;sidebarIsClosed||(e=pageIsMobileFormat(),$("#sidebar").animate({width:"toggle"},{complete:function(){$("#sidebarText").html("")}}),!e&&$("#settings").is(":visible")||$("#settings").animate({width:"toggle",height:"toggle"}),datePickerDivHiddenOnSidebar&&(datePickerDivHiddenOnSidebar=!1,toggleDatePickerDiv(e)),map.removeLayer("marked-layer"),map.removeSource("marked"),sidebarIsClosed=!0,selectedMarker=null)}function clickSettingsButton(e){loading||null!==e&&e!==settingsOpened||($("#settingsButton").animate({degrees:settingsOpened?-180:180},{duration:180,step:function(e){$(this).css({transform:"rotate("+e+"deg)"})},complete:function(){settingsOpened=!settingsOpened}}),$("#settingsPanel").animate({width:"toggle",height:"toggle"},{duration:200}),toggleDatePickerDiv(null))}function addMarkers(e,t,r,a,i){for(const u in r){var n,o,s,l,d,c,g=r[u];3<=g.daysSinceEvent&&"true"===onlyNewDataCookie||(n=[g.type,"ReliefWeb Report","IPS News Article"][i],o=useBlack(a[u]),o=getMarkerImagePath(0===i?g.type:"report",o),s=new Date(g.date),(l=document.createElement("div")).style.width="32px",l.style.height="32px",l.style.backgroundSize="contain",l.style.cursor="pointer",l.style.backgroundColor=a[u],l.style.borderRadius="50%",l.style.border="1px solid "+a[u],l.style.opacity="0.72",l.style.backgroundImage=`url(${o})`,d=document.createElement("div"),l.appendChild(d),d.style.width="18px",d.style.height="18px",d.style.backgroundColor="red",d.style.borderRadius="50%",d.style.backgroundSize="contain",d.style.color="white",d.style.opacity="0.9",d.style.border="1px solid red",d.classList.add("topRightText"),d.classList.add("eventDuration"),d.style.display="true"===showEventDurationCookie?"block":"none",c=document.createElement("div"),d.appendChild(c),c.textContent=g.daysSinceEvent,c.style.fontSize="0.8rem",c.classList.add("absoluteCenter"),d=new maplibregl.Marker(l,{color:a[u],draggable:!1,anchor:"center"}).setLngLat([g.lon,g.lat]),c=s.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),d.description=`<div><img src="${o.replace(/white/g,"black")}" alt="event type" style="width: 2rem; height: 2rem; margin-bottom: 0.5rem"><br><i>`+n+"</i></div><p><small>"+c+'</small></p><h2><a href="'+g.url+'">'+g.title+"</a></h2><br>"+g.description_html.replace(/&quot;/g,'"'),d.color=a[u],d.eventIndex=Number(u),d.source=i,d.lat=g.lat,d.lon=g.lon,d.addTo(e),t.push(d))}}function toggleLayer(e,t,r,a){e.setLayoutProperty(r,"visibility",a?"visible":"none");const i={0:"disaster-layer",1:"report-layer",2:"news-layer"};t.filter(e=>r===i[e.source]).forEach(e=>e.getElement().style.display=a?"block":"none")}