let sidebarIsClosed=!0,selectedMarker=null,settingsOpened=!1,loading=!0,datePickerDivHiddenOnSidebar=!1;function pageIsMobileFormat(){return 1.4<=$(window).innerHeight()/$(window).innerWidth()}function setLoading(e){e!==loading&&(e?$("#earth").show():$("#earth").hide(),$("#settings").animate({width:"toggle",height:"toggle"}),loading=e)}function hexToRgb(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,r,i){return t+t+r+r+i+i});e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function useBlack(e){e=hexToRgb(e);return 150<(299*e.r+587*e.g+114*e.b)/1e3}function getGeoJSONFromEvent(e,t){var r={type:"FeatureCollection",features:[]};for(const i of e.features)i.properties.eventIndex===t&&r.features.push(i);return r}function getMarkerImagePath(e,t){return"/markers/"+(t?"black":"white")+"/"+e.toLowerCase().replace(/ /g,"_")+".png"}function toggleDatePickerDiv(e){e=e||pageIsMobileFormat();var t=$("#datePickerDiv");t.css("top",e?"auto":"0"),t.css("bottom",e?"0":"auto"),t.css("border-radius",e?"1rem 1rem 0 0":"0 0 1rem 1rem"),t.animate({height:"toggle"},{duration:200})}function openSideBar(e,t,r){var i=hexToRgb(t.color),a=$("#sidebar"),n=$("#sidebarContent"),o=pageIsMobileFormat(),s=o?"100%":"42%",n=(n.css("background",`rgba(${i.r}, ${i.g}, ${i.b}, 0.19)`),sidebarIsClosed?(a.css("width",s),a.animate({width:"toggle"},{complete:function(){$("#sidebarText").html(t.description),$("#sidebarText a").attr("target","_blank")}}),o&&($("#settings").animate({width:"toggle",height:"toggle"}),$("#datePickerDiv").is(":visible")&&(datePickerDivHiddenOnSidebar=!0,$("#datePickerDiv").animate({height:"toggle"})))):($("#sidebarText").html(t.description),$("#sidebarText a").attr("target","_blank")),getGeoJSONFromEvent(r,t.eventIndex));sidebarIsClosed||(e.removeLayer("marked-layer"),e.removeSource("marked")),e.addSource("marked",{type:"geojson",data:n}),e.addLayer({id:"marked-layer",type:"fill",source:"marked",layout:{},paint:{"fill-color":["get","fill"],"fill-opacity":.9}}),sidebarIsClosed=!1,selectedMarker=t}function closeSideBar(){var e;sidebarIsClosed||(e=pageIsMobileFormat(),$("#sidebar").animate({width:"toggle"},{complete:function(){$("#sidebarText").html("")}}),!e&&$("#settings").is(":visible")||$("#settings").animate({width:"toggle",height:"toggle"}),datePickerDivHiddenOnSidebar&&(datePickerDivHiddenOnSidebar=!1,toggleDatePickerDiv(e)),map.removeLayer("marked-layer"),map.removeSource("marked"),sidebarIsClosed=!0,selectedMarker=null)}function clickSettingsButton(e){loading||null!==e&&e!==settingsOpened||($("#settingsButton").animate({degrees:settingsOpened?-180:180},{duration:180,step:function(e){$(this).css({transform:"rotate("+e+"deg)"})},complete:function(){settingsOpened=!settingsOpened}}),$("#settingsPanel").animate({width:"toggle",height:"toggle"},{duration:200}),toggleDatePickerDiv(null))}function addMarkers(e,t,r,i,a){for(const u in r){var n=r[u],o=[n.type,"ReliefWeb Report","IPS News Article"][a],s=useBlack(i[u]),s=getMarkerImagePath(n.type,s),l=new Date(n.date),d=document.createElement("div"),g=(d.title=n.title,d.style.width="32px",d.style.height="32px",d.style.backgroundSize="contain",d.style.cursor="pointer",d.style.backgroundColor=i[u],d.style.borderRadius="50%",d.style.border="1px solid "+i[u],d.style.opacity="0.72",d.style.backgroundImage=`url(${s})`,document.createElement("div")),c=(d.appendChild(g),g.style.width="18px",g.style.height="18px",g.style.backgroundColor="red",g.style.borderRadius="50%",g.style.backgroundSize="contain",g.style.color="white",g.style.opacity="0.9",g.style.border="1px solid red",g.classList.add("topRightText"),g.classList.add("eventDuration"),g.style.display="true"===showEventDurationCookie?"block":"none",document.createElement("div")),g=(g.appendChild(c),c.textContent=n.daysSinceEvent,c.style.fontSize="0.8rem",c.classList.add("absoluteCenter"),new maplibregl.Marker(d,{color:i[u],draggable:!1,anchor:"center"}).setLngLat([n.lon,n.lat])),c=l.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});g.description=`<div><img src="${s.replace(/white/g,"black")}" alt="event type" style="width: 2rem; height: 2rem; margin-bottom: 0.5rem"><br><i>`+o+"</i></div><p><small>"+c+'</small></p><h2><a href="'+n.url+'">'+n.title+"</a></h2><br>"+n.description_html.replace(/&quot;/g,'"'),g.color=i[u],g.eventIndex=Number(u),g.source=a,g.lat=n.lat,g.lon=n.lon,g.addTo(e),t.push(g)}}function toggleLayer(e,t,r,i){e.setLayoutProperty(r,"visibility",i?"visible":"none");const a={0:"disaster-layer",1:"report-layer",2:"news-layer"};t.filter(e=>r===a[e.source]).forEach(e=>e.getElement().style.display=i?"block":"none")}