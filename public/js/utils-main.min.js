let sidebarIsClosed=!0,selectedMarker=null,settingsOpened=!1,loading=!0,datePickerDivHiddenOnSidebar=!1,useGeoJSON;function pageIsMobileFormat(){return 1.4<=$(window).innerHeight()/$(window).innerWidth()}function setLoading(e){e!==loading&&(e?$("#earth").show():$("#earth").hide(),$("#settings").animate({width:"toggle",height:"toggle"}),loading=e)}function hexToRgb(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,i,a){return t+t+i+i+a+a});e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function useBlack(e){e=hexToRgb(e);return 150<(299*e.r+587*e.g+114*e.b)/1e3}function getGeoJSONFromEvent(e,t){var i={type:"FeatureCollection",features:[]};for(const a of e.features)a.properties.eventIndex===t&&i.features.push(a);return i}function getMarkerImagePath(e,t){return"/markers/"+(t?"black":"white")+"/"+e.toLowerCase().replace(/ /g,"_")+".png"}function toggleDatePickerDiv(e){e=e||pageIsMobileFormat();var t=$("#datePickerDiv");t.css("top",e?"auto":"0"),t.css("bottom",e?"0":"auto"),t.css("border-radius",e?"1rem 1rem 0 0":"0 0 1rem 1rem"),t.animate({height:"toggle"},{duration:200})}async function openSideBar(e,t,i){var a=hexToRgb(t.color),r=$("#sidebar"),o=$("#sidebarContent"),n=pageIsMobileFormat(),s=n?"100%":"42%";o.css("background",`rgba(${a.r}, ${a.g}, ${a.b}, 0.19)`),!1===t.descriptionLoaded&&200===(a=await fetch("/api/text/"+["disaster","report","news"][t.source]+"/"+t.id)).status&&(a=await a.text(),t.descriptionLoaded=!0,t.description+=a.replace(/&quot;/g,'"')),sidebarIsClosed?(r.css("width",s),r.animate({width:"toggle"},{complete:function(){$("#sidebarText").html(t.description),$("#sidebarText a").attr("target","_blank")}}),n&&($("#settings").animate({width:"toggle",height:"toggle"}),$("#datePickerDiv").is(":visible")&&(datePickerDivHiddenOnSidebar=!0,$("#datePickerDiv").animate({height:"toggle"})))):($("#sidebarText").html(t.description),$("#sidebarText a").attr("target","_blank"),o.scrollTop(0)),useGeoJSON&&(a=getGeoJSONFromEvent(i,t.eventIndex),sidebarIsClosed||(e.removeLayer("marked-layer"),e.removeSource("marked")),e.addSource("marked",{type:"geojson",data:a}),e.addLayer({id:"marked-layer",type:"fill",source:"marked",layout:{},paint:{"fill-color":["get","fill"],"fill-opacity":.9}})),sidebarIsClosed=!1,selectedMarker=t}function closeSideBar(){var e;sidebarIsClosed||(e=pageIsMobileFormat(),$("#sidebar").animate({width:"toggle"},{complete:function(){$("#sidebarText").html("")}}),!e&&$("#settings").is(":visible")||$("#settings").animate({width:"toggle",height:"toggle"}),datePickerDivHiddenOnSidebar&&(datePickerDivHiddenOnSidebar=!1,toggleDatePickerDiv(e)),useGeoJSON&&(map.removeLayer("marked-layer"),map.removeSource("marked")),sidebarIsClosed=!0,selectedMarker=null)}function clickSettingsButton(e){loading||null!==e&&e!==settingsOpened||($("#settingsButton").animate({degrees:settingsOpened?-180:180},{duration:180,step:function(e){$(this).css({transform:"rotate("+e+"deg)"})},complete:function(){settingsOpened=!settingsOpened}}),$("#settingsPanel").animate({width:"toggle",height:"toggle"},{duration:200}),toggleDatePickerDiv(null))}function addMarkers(t,i,a,r,o){for(let e=0;e<a.length;e++){var n=a[e],s=[n.type,"ReliefWeb Report","IPS News Article"][o],l=useBlack(r[e]),l=getMarkerImagePath(n.type,l),d=new Date(n.date),c=document.createElement("div"),g=(c.title=n.title,c.style.width="32px",c.style.height="32px",c.style.backgroundSize="contain",c.style.cursor="pointer",c.style.backgroundColor=r[e],c.style.borderRadius="50%",c.style.border="1px solid "+r[e],c.style.opacity="0.72",c.style.backgroundImage=`url(${l})`,document.createElement("div")),u=(c.appendChild(g),g.style.width="18px",g.style.height="18px",g.style.backgroundColor="red",g.style.borderRadius="50%",g.style.backgroundSize="contain",g.style.color="white",g.style.opacity="0.9",g.style.border="1px solid red",g.classList.add("topRightText"),g.classList.add("eventDuration"),g.style.display="true"===showEventDurationCookie?"block":"none",document.createElement("div")),g=(g.appendChild(u),u.textContent=n.daysSinceEvent,u.style.fontSize="0.8rem",u.classList.add("absoluteCenter"),new maplibregl.Marker(c,{color:r[e],draggable:!1,anchor:"center"}).setLngLat([n.lon,n.lat])),u=d.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});g.articleTitle=n.title,g.articleDate=u,g.date=d,g.description=`<div><img src="${l.replace(/white/g,"black")}" alt="event type" style="width: 2rem; height: 2rem; margin-bottom: 0.5rem"><br><i>`+s+"</i></div><p><small>"+u+'</small></p><h2><a href="'+n.url+'">'+n.title+"</a></h2><br>",g.descriptionLoaded=!1,g.id=n.id,g.color=r[e],g.eventIndex=Number(e),g.source=o,g.lat=n.lat,g.lon=n.lon,g.addTo(t),i.push(g)}}function toggleLayer(e,t,i,a){useGeoJSON&&e.setLayoutProperty(i,"visibility",a?"visible":"none");const r={0:"disaster-layer",1:"report-layer",2:"news-layer"};t.filter(e=>i===r[e.source]).forEach(e=>e.getElement().style.display=a?"block":"none")}useGeoJSON=!pageIsMobileFormat();